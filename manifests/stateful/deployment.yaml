#############################################################
######################### stateful-proxy #########################

# Service exposing stateful-proxy service on node port 3000
apiVersion: v1
kind: Service
metadata:
  name: stateful-proxy
  annotations:
    prometheus.io/scrape: 'true'
    prometheus.io/port: '3500'
spec:
  type: ClusterIP
  selector:
    tier: webserver
    app: stateful-proxy
  ports:
  - port: 3000
    name: http-fr
    targetPort: http-front
---
# deployment of the container stateful-proxy listening to port 3500
apiVersion: apps/v1
kind: Deployment
metadata:
  name: stateful-proxy
  annotations:
    prometheus.io/scrape: 'true'
    prometheus.io/port: '3500'
spec:
  serviceAccountName: pod-reader-account
  replicas: 1
  selector:
    matchLabels:
      tier: webserver
      app: stateful-proxy
  template:
    metadata:
      labels:
        tier: webserver
        app: stateful-proxy
    spec:
      imagePullSecrets:
       - name: wyn-acr-secret
      containers:
      - name: stateful-proxy
        image: wynsurek8sacr.azurecr.io/pod-sticker:latest
        imagePullPolicy: Always
        env:
        - name: NODE_ENV
          value: "production"
        - name: POD_NAME_SELECTOR
          value: "stateful-dpl"
        ports:
           - name: http-front
             containerPort: 9000
      nodeSelector:
          kubernetes.io/os: linux        


